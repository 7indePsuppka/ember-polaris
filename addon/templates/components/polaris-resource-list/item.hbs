<div
  data-test-id="item-wrapper"
  data-href={{@url}}
  class="Polaris-ResourceList-Item
    {{if this.focused "Polaris-ResourceList-Item--focused"}}
    {{if this.selectable "Polaris-ResourceList-Item--selectable"}}
    {{if this.selected "Polaris-ResourceList-Item--selected"}}
    {{if this.selectMode "Polaris-ResourceList-Item--selectMode"}}
    {{if @persistActions "Polaris-ResourceList-Item--persistActions"}}
    {{if this.focusedInner "Polaris-ResourceList-Item--focusedInner"}}
  "
  {{on "click" this.handleClick}}
  {{on "focusin" this.handleFocus}}
  {{on "focusout" this.handleBlur}}
  {{on "mousedown" this.handleMouseDown}}
  {{on "keyup" this.handleKeypress}}
  {{did-insert this.insertResourceListItem}}
  ...attributes
>
  {{#with (if @loading "-1" "0") as |tabIndex|}}
    {{#if @url}}
      <PolarisUnstyledLink
        class="Polaris-ResourceList-Item__Link"
        @ariaDescribedBy={{@itemId}}
        @ariaLabel={{@accessibilityLabel}}
        @url={{@url}}
        @tabIndex={{tabIndex}}
        @onFocus={{fn this.handleAnchorFocus}}
        @onBlur={{fn this.handleFocusedBlur}}
      />
    {{else}}
      <WrapperElement
        class="Polaris-ResourceList-Item__Button"
        @tagName="button"
        @aria-label={{@accessibilityLabel}}
        @aria-controls={{@ariaControls}}
        @aria-expanded={{@ariaExpanded}}
        @click={{fn this.handleClick}}
        @focusIn={{fn this.handleAnchorFocus}}
        @focusOut={{fn this.handleFocusedBlur}}
        @tabIndex={{tabIndex}}
      />
    {{/if}}
  {{/with}}

  <div
    data-test-id="item-content"
    class="Polaris-ResourceList-Item__Container"
    id={{@itemId}}
  >
    {{#if (or @media this.selectable)}}
      <div class="Polaris-ResourceList-Item__Owned">
        {{#if this.selectable}}
          <WrapperElement
            class="Polaris-ResourceList-Item__Handle"
            @tagName="div"
            @data-test-id="larger-selection-area"
            @click={{fn this.handleLargerSelectionArea}}
          >
            <WrapperElement
              class="Polaris-ResourceList-Item__CheckboxWrapper"
              @tagName="div"
              @click={{fn this.stopPropagation}}
            >
              <PolarisCheckbox
                @id={{this.checkboxId}}
                @label={{label}}
                @labelHidden={{true}}
                @checked={{this.isSelected}}
                @disabled={{@loading}}
                @onChange={{fn this.handleSelection}}
              />
            </WrapperElement>
          </WrapperElement>
        {{/if}}

        {{#if @media}}
          <div class="Polaris-ResourceList-Item__Media" data-test-id="media">
            {{render-content @media}}
          </div>
        {{/if}}
      </div>
    {{/if}}

    {{#if (or hasBlock @children)}}
      <div class="Polaris-ResourceList-Item__Content">
        {{#if hasBlock}}
          {{yield}}
        {{else}}
          {{render-content @children}}
        {{/if}}
      </div>
    {{/if}}

    {{#if (and @shortcutActions (not @loading))}}
      <WrapperElement
        class="Polaris-ResourceList-Item__Actions"
        @tagName="div"
        @click={{fn this.stopPropagation}}
      >
        <PolarisButtonGroup
          data-test-id={{unless @persistActions "shortcut-actions"}}
          @segmented={{not @persistActions}}
          as |buttonGroup|
        >
          {{#each @shortcutActions as |shortcutAction|}}
            <buttonGroup.item>
              <PolarisButton
                @size="slim"
                @plain={{@persistActions}}
                @text={{shortcutAction.text}}
                @accessibilityLabel={{shortcutAction.accessibilityLabel}}
                @url={{shortcutAction.url}}
                @external={{shortcutAction.external}}
                @destructive={{shortcutAction.destructive}}
                @icon={{shortcutAction.icon}}
                @loading={{shortcutAction.loading}}
                @disabled={{shortcutAction.disabled}}
                @onClick={{fn (or shortcutAction.onAction (action (mut dummy)))}}
              />
            </buttonGroup.item>
          {{/each}}
        </PolarisButtonGroup>
      </WrapperElement>

      {{#if @persistActions}}
        <WrapperElement
          class="Polaris-ResourceList-Item__Disclosure"
          @tagName="div"
          @click={{fn this.stopPropagation}}
        >
          <PolarisPopover as |popover|>
            <popover.activator>
              {{!--
                Possible mistake in the Polaris source here as
                `Button` doesn't seem to support `aria-label`.
                Matching what they do for now, and if they fix
                it we can update ;)
              --}}
              <PolarisButton
                aria-label="Actions dropdown"
                @plain={{true}}
                @icon="horizontal-dots"
                @onClick={{fn popover.toggle}}
              />
            </popover.activator>

            <popover.content>
              <PolarisActionList @items={{@shortcutActions}} />
            </popover.content>
          </PolarisPopover>
        </WrapperElement>
      {{/if}}
    {{/if}}
  </div>
</div>
