{{! template-lint-disable no-invalid-interactive }}

{{#if url}}
  {{!-- TODO: check focusIn/Out work here. --}}
  {{polaris-unstyled-link
    class="Polaris-ResourceList-Item__Link"
    ariaDescribedBy=id
    ariaLabel=accessibilityLabel
    url=url
    focusIn=(action handleAnchorFocus)
    focusOut=(action handleFocusedBlur)
  }}
{{else}}
  {{!-- TODO: hook up click, focus and blur handlers here. --}}
  <button
    class="Polaris-ResourceList-Item__Button"
    aria-label={{accessibilityLabel}}
    aria-controls={{ariaControls}}
    aria-expanded={{ariaExpanded}}
    onClick={{action handleClick}}
    onFocus={{action handleAnchorFocus}}
    onBlur={{action handleFocusedBlur}}
  />
{{/if}}

<div
  data-test-id="item-content"
  class="Polaris-ResourceList-Item__Container"
  id={{id}}
>
  {{#if (or media selectable)}}
    <div class="Polaris-ResourceList-Item__Owned">
      {{#if selectable}}
        {{#wrapper-element
          tagName="div"
          class="Polaris-ResourceList-Item__Handle"
          data-test-id="larger-selection-area"
          click=(action handleLargerSelectionArea)
        }}
          {{!-- TODO: check if `click` here (and elsewhere) works. --}}
          <div
            class="Polaris-ResourceList-Item__CheckboxWrapper"
            click={{action stopPropagation}}
          >
            {{polaris-checkbox
              id=checkboxId
              label=label
              labelHidden=true
              checked=isSelected
              disabled=loading
              onChange=(action handleSelection)
            }}
          </div>
        {{/wrapper-element}}
      {{/if}}

      {{#if media}}
        <div class="Polaris-ResourceList-Item__Media" data-test-id="media">
          {{render-content media}}
        </div>
      {{/if}}
    </div>
  {{/if}}

  {{#if children}}
    <div class="Polaris-ResourceList-Item__Content">
      {{render-content children}}
    </div>
  {{/if}}

  {{#if shortcutActions}}
    <div class="Polaris-ResourceList-Item__Actions" {{action stopPropagation}}>
      {{#polaris-button-group
        segmented=(not persistActions)
        data-test-id=(unless persistActions "shortcut-actions")
        as |buttonGroup|
      }}
        {{#each shortcutActions as shortcutAction}}
          {{#buttonGroup.item}}
            {{polaris-button
              size="slim"
              plain=persistActions
              text=shortcutAction.text
              accessibilityLabel=shortcutAction.accessibilityLabel
              url=shortcutAction.url
              external=shortcutAction.external
              destructive=shortcutAction.destructive
              icon=shortcutAction.icon
              loading=shortcutAction.loading
              onClick=(action shortcutAction.onAction)
            }}
          {{/buttonGroup.item}}
        {{/each}}
      {{/polaris-button-group}}
    </div>

    {{#if persistActions}}
      <div class="Polaris-ResourceList-Item__Disclosure" {{action stopPropagation}}>
        {{#polaris-popover
          as |popover|
        }}
          {{#popover.activator}}
            {{!--
              Possible mistake in the Polaris source here as
              `Button` doesn't seem to support `aria-label`.
              Matching what they do for now, and if they fix
              it we can update ;)
            --}}
            {{polaris-button
              aria-label="Actions dropdown"
              plain=true
              icon="horizontal-dots"
              onClick=(action popover.toggle)
            }}
          {{/popover.activator}}

          {{#popover.content}}
            {{polaris-action-list items=shortcutActions}}
          {{/popover.content}}
        {{/polaris-popover}}
      </div>
    {{/if}}
  {{/if}}
</div>
