<PolarisPopover @sectioned={{true}} @fullHeight={{true}} as |popover|>
  {{#component (if disabled
    (component "wrapper-element" tagName="")
    popover.activator
  )}}
    <PolarisButton @dataTestId="filter-activator" @text="Filter" @disclosure={{true}} @disabled={{disabled}} @onFocus={{action handleButtonFocus}} />
  {{/component}}

  <popover.content>
    <PolarisForm @onSubmit={{action handleAddFilter popover}}>
      <PolarisFormLayout as |formLayout|>
        <PolarisSelect @placeholder="Select a filter..." @label={{selectLabel}} @options={{filterOptions}} @value={{or selectedFilter.key ""}} @onChange={{action handleFilterKeyChange}} />

        {{#if selectedFilter}}
          <formLayout.item>
            <PolarisResourceList::FilterControl::FilterValueSelector @filter={{selectedFilter}} @filterKey={{selectedFilterKey}} @value={{selectedFilterValue}} @onFilterKeyChange={{action handleFilterKeyChange}} @onChange={{action (mut selectedFilterValue)}} />
          </formLayout.item>

          <formLayout.item>
            <PolarisButton @dataTestId="add-filter" @text="Add filter" @disabled={{not canAddFilter}} @onClick={{action handleAddFilter popover}} />
          </formLayout.item>
        {{/if}}
      </PolarisFormLayout>
    </PolarisForm>
  </popover.content>
</PolarisPopover>
